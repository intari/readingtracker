import java.text.SimpleDateFormat

apply plugin: 'com.android.application'

//update version code on eache build
/*
 1.0 - dollmaster/non-gradle booktracker
 1.1 - initial versions of gradle-based booktracker
 */
def myVersionName="1.1"
def myVersionCode=104

def gitSha() {
    def res = 'git rev-parse HEAD'.execute([], project.rootDir).text.trim()

    def diff = 'git diff'.execute([], project.rootDir).text.trim()
    if (diff != null && diff.length() > 0) {
        res += "-dirty"
    }
    return res
}

def buildTime() {
    def df = new SimpleDateFormat("yyyy-MM-dd'T'HH:mm'Z'") //you can change it
    df.setTimeZone(TimeZone.getTimeZone("UTC")) //RTZ5 (Omsk) is UTC+6 per https://ru.wikipedia.org/wiki/Время_в_России
    return df.format(new Date())
}


android {
    compileSdkVersion 'Google Inc.:Google APIs:17'
    buildToolsVersion "21.1.2"

    defaultConfig {
        applicationId "com.viorsan.dollmaster"
        minSdkVersion 17
        targetSdkVersion 17
        versionCode myVersionCode
        versionName myVersionName+"."+versionCode+"-built_at-"+buildTime()+'-git-sha1-'+gitSha();

        //versionCode versionMajor * 10000 + versionMinor * 1000 + versionPatch * 100 + versionBuild
        //versionName "${versionMajor}.${versionMinor}" + ((versionPatch != 0) ? ".${versionPatch}" : "")
    }
    productFlavors {
        //TODO: find out HOW to configure this CORRECTLY
        //Why first flavor choose for debug automatically?
        //how to use flavors to change packageName/ApplicationId/title?
        internal {
            versionCode myVersionCode
            versionName myVersionName+"."+versionCode+"-internal"+"-built_at-"+buildTime()+'-git-sha1-'+gitSha();
         }
        playstore {
            versionCode myVersionCode
            versionName myVersionName+"."+versionCode+"-playstore"+"-built_at-"+buildTime()+'-git-sha1-'+gitSha();
        }
    }


    buildTypes {
        release {
            minifyEnabled false
            proguardFiles getDefaultProguardFile('proguard-android.txt'), 'proguard-rules.txt'
        }
    }
}

dependencies {
    compile 'com.google.code.gson:gson:2.2.2'
    //compile 'com.google.android.gms:play-services:+'
    compile 'com.google.android.gms:play-services:6.5.+'
    //compile 'com.google.android.gms:play-services-location:6.5.+'
    compile files('libs/HockeySDK-3.0.1.jar')
    compile files('libs/Parse-1.5.0.jar')
    compile files('libs/acra-4.4.0.jar')
    //compile files('libs/android-support-v13.jar')
    compile files('libs/json-simple-1.1.1.jar')
    compile files('libs/jmdns-3.4.1.jar')
}
